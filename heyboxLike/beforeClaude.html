<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>小黑盒剑星点赞特效</title>
    <link rel="icon" href="../icon/fav.ico" />
    <style>
      body {
        background: #e4e4e4;
      }

      .clickEffect {
        position: fixed;
        z-index: 2147483647;
        pointer-events: none;
        opacity: 0;
        animation: appear 0.2s forwards;
      }

      @keyframes appear {
        0% {
          opacity: 0;
        }
        100% {
          opacity: 1;
        }
      }

      .firstCircle {
        position: absolute;
        width: 0px;
        height: 0px;
        border-radius: 50%;
        border: solid rgba(143, 143, 143, 1);
        transition: border-width 0.2s cubic-bezier(0, 0.8, 0.9, 1),
          width 0.2s cubic-bezier(0, 0.8, 0.9, 1),
          height 0.2s cubic-bezier(0, 0.8, 0.9, 1);
        animation: firstCircleAnimation 0.2s cubic-bezier(0, 0, 0.4, 1) forwards;
        clip-path: circle(10%);
      }

      @keyframes firstCircleAnimation {
        0% {
          clip-path: circle(10%);
        }
        100% {
          clip-path: circle(50%);
        }
      }

      .centerImg {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        object-fit: cover;
        animation: centerImgAnimation 0.7s forwards;
        animation-delay: 0.3s;
        transition: clip-path 0.4s;
      }

      @keyframes centerImgAnimation {
        0% {
          transform: translate(-50%, -50%) translateY(0%) rotate(0deg);
        }
        10% {
          transform: translate(-50%, -50%) translateY(-20%) rotate(0deg);
        }
        20% {
          transform: translate(-50%, -50%) translateY(-20%) rotate(5deg);
        }
        40% {
          transform: translate(-50%, -50%) translateY(-20%) rotate(-5deg);
        }
        60% {
          transform: translate(-50%, -50%) translateY(-20%) rotate(5deg);
        }
        80% {
          transform: translate(-50%, -50%) translateY(-20%) rotate(-5deg);
        }
        90% {
          transform: translate(-50%, -50%) translateY(-20%) rotate(0deg);
        }
        100% {
          transform: translate(-50%, -50%) translateY(0%) rotate(0deg);
        }
      }

      .points {
        position: absolute;
        width: 100%;
        height: 100%;
      }

      .point {
        position: absolute;
        border-radius: 50%;
        width: 0px;
        height: 0px;
        transform: translate(-50%, -50%);
        left: 50%;
        top: 50%;
        background-color: rgb(143, 143, 143);
        transition: transform 1s cubic-bezier(0, 0.8, 0.9, 1),
          width 1s cubic-bezier(0, 0, 0.4, 1),
          height 1s cubic-bezier(0, 0, 0.4, 1);
        animation: pointAnimation 0.4s forwards;
        animation-delay: 1s;
        clip-path: circle(50%);
      }

      @keyframes pointAnimation {
        0% {
          clip-path: circle(50%);
        }
        100% {
          clip-path: circle(0%);
        }
      }

      .aroundDiv {
        position: absolute;
        width: 100%;
        height: 100%;
      }

      .aroundImg {
        position: absolute;
        object-fit: cover;
        width: 0px;
        height: 0px;
        transform: translate(-50%, -50%);
        left: 50%;
        top: 50%;
        transition: transform 1s, width 1s cubic-bezier(0, 0, 0.4, 1),
          height 1s cubic-bezier(0, 0, 0.4, 1);
      }

      .clouds {
        position: absolute;
        width: 100%;
        height: 100%;
      }

      .cloud {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        opacity: 0;
      }

      .cloudImg {
        object-fit: cover;
        transition: transform 0.5s;
        position: absolute;
      }
    </style>
  </head>
  <body>
    <video src="./img/source.mp4" controls loop muted autoplay></video>
    <!-- <div class="clickEffect">
      <img src="./img/center.png" class="centerImg" alt="center image" />
      <div class="firstCircle"></div>
      <div class="points">
        <div class="point"></div>
      </div>
      <div class="aroundDiv">
        <img src="./img/around.png" class="aroundImg" alt="around image" />
        <div class="clouds">
          <div class="cloud">
            <img class="cloudImg" src="./img/cloud.png" alt="cloud img" />
            <img class="cloudImg" src="./img/cloud.png" alt="cloud img" />
            <img class="cloudImg" src="./img/cloud.png" alt="cloud img" />
          </div>
        </div>
      </div>
    </div> -->
  </body>
  <script>
    const clickSize = 70; // 点击效果的大小
    const pointCount = 6; // 点的数量
    const aroundImgCount = 3; // 周围图片的数量
    // 确保x，y在指定的范围内
    const confirmFinalRange = (startRange, endRange) => {
      let x = clickSize * endRange * (Math.random() - 0.5);
      let y = clickSize * endRange * (Math.random() - 0.5);
      while (
        x * x + y * y <
          ((clickSize * startRange) / 2) * ((clickSize * startRange) / 2) ||
        x * x + y * y >
          ((clickSize * endRange) / 2) * ((clickSize * endRange) / 2)
      ) {
        x = clickSize * endRange * (Math.random() - 0.5);
        y = clickSize * endRange * (Math.random() - 0.5);
      }
      return { x, y };
    };
    const handleClick = (e) => {
      const clickEffect = document.createElement("div");
      clickEffect.className = "clickEffect";
      clickEffect.style.left = e.clientX - clickSize / 2 + "px";
      clickEffect.style.top = e.clientY - clickSize / 2 + "px";
      clickEffect.style.width = clickSize + "px";
      clickEffect.style.height = clickSize + "px";
      setTimeout(() => {
        clickEffect.style.opacity = "1";
      }, 10);

      // center image
      const centerImg = document.createElement("img");
      centerImg.src = "./img/center.png";
      centerImg.className = "centerImg";
      centerImg.style.clipPath = "circle(100%)";
      setTimeout(() => {
        centerImg.style.clipPath = "circle(0%)";
      }, 1000);
      clickEffect.appendChild(centerImg);

      // first circle
      const firstCircle = document.createElement("div");
      firstCircle.className = "firstCircle";
      firstCircle.style.borderWidth = clickSize / 2 + "px";
      setTimeout(() => {
        firstCircle.style.width = clickSize + "px";
        firstCircle.style.height = clickSize + "px";
        firstCircle.style.borderWidth = "0px";
      }, 200);
      clickEffect.appendChild(firstCircle);

      // points
      const points = document.createElement("div");
      points.className = "points";
      for (let i = 0; i < pointCount; i++) {
        const point = document.createElement("div");
        point.className = "point";
        const finalSize = Math.floor(Math.random() * 6 + 6);
        const { x: finalTranslateX, y: finalTranslateY } = confirmFinalRange(
          1.1,
          1.5
        );
        setTimeout(() => {
          point.style.width = finalSize + "px";
          point.style.height = finalSize + "px";
          point.style.transform = `translate(${finalTranslateX}px, ${finalTranslateY}px)`;
        }, 10);
        points.appendChild(point);
      }
      clickEffect.appendChild(points);

      // around div
      const aroundDiv = document.createElement("div");
      aroundDiv.className = "aroundDiv";
      const aroundImgArray = [];
      for (let i = 0; i < aroundImgCount; i++) {
        const aroundImg = document.createElement("img");
        aroundImg.src = "./img/around.png";
        aroundImg.className = "aroundImg";
        aroundImg.style.animationDelay = i * 0.1 + "s";
        const finalSize = Math.floor(Math.random() * 30 + 35);
        const { x: finalTranslateX, y: finalTranslateY } = confirmFinalRange(
          1.2,
          1.8
        );
        aroundImgArray.push({
          finalTranslateX,
          finalTranslateY,
          finalSize,
        });
        const finalRotate = Math.random() * 900 - 450;
        setTimeout(() => {
          aroundImg.style.width = finalSize + "px";
          aroundImg.style.height = finalSize + "px";
          aroundImg.style.transform = `translate(${finalTranslateX * 1.2}px, ${
            finalTranslateY * 1.2
          }px) rotate(${finalRotate}deg)`;
          setTimeout(() => {
            aroundImg.style.transition =
              "transform 1s ,width 1s cubic-bezier(0, 0, 0.4, 1),height 1s cubic-bezier(0, 0, 0.4, 1)";
            aroundImg.style.transform = `translate(${finalTranslateX}px, ${finalTranslateY}px) rotate(${
              finalRotate * 0.05
            }deg)`;
          }, 500);
        }, 10 + 100 * i);
        setTimeout(() => {
          aroundImg.style.opacity = "0";
        }, 1000 + i * 100);
        aroundDiv.appendChild(aroundImg);
      }
      clickEffect.appendChild(aroundDiv);

      // clouds
      const clouds = document.createElement("div");
      clouds.className = "clouds";
      for (let i = 0; i < aroundImgCount; i++) {
        const cloud = document.createElement("div");
        cloud.className = "cloud";
        const cloudImgCount = 3;
        for (let j = 0; j < cloudImgCount; j++) {
          const cloudImg = document.createElement("img");
          cloudImg.className = "cloudImg";
          cloudImg.src = "./img/cloud.png";
          cloudImg.style.width = Math.floor(Math.random() * 60 + 60) + "%";
          cloudImg.style.height = Math.floor(Math.random() * 40 + 40) + "%";
          switch (j) {
            case 0:
              cloudImg.style.left = "50%";
              cloudImg.style.top = "0%";
              cloudImg.style.transform = `translate(-50%, 0%) scale(1)`;
              setTimeout(() => {
                cloudImg.style.transform = `translate(${
                  Math.random() * 100 - 50
                }%, -50%) scale(0)`;
              }, 1010 + i * 100);
              break;
            case 1:
              cloudImg.style.left = "0%";
              cloudImg.style.bottom = "0%";
              cloudImg.style.transform = `translate(0%, 0%) scale(1)`;
              setTimeout(() => {
                cloudImg.style.transform = `translate(${
                  Math.random() * -100
                }%, 50%) scale(0)`;
              }, 1010 + i * 100);
              break;
            case 2:
              cloudImg.style.right = "0%";
              cloudImg.style.bottom = "0%";
              cloudImg.style.transform = `translate(0%, 0%) scale(1)`;
              setTimeout(() => {
                cloudImg.style.transform = `translate(${
                  Math.random() * 100
                }%, 50%) scale(0)`;
              }, 1010 + i * 100);
              break;
          }
          cloud.appendChild(cloudImg);
        }
        const initialTranslateX = aroundImgArray[i].finalTranslateX;
        const initialTranslateY = aroundImgArray[i].finalTranslateY;
        cloud.style.width = aroundImgArray[i].finalSize + "px";
        cloud.style.height = aroundImgArray[i].finalSize + "px";
        cloud.style.transform = `translate(${initialTranslateX}px, ${initialTranslateY}px)`;
        setTimeout(() => {
          cloud.style.opacity = "1";
        }, 1000 + i * 100);
        clouds.appendChild(cloud);
      }
      clickEffect.appendChild(clouds);

      // append to body
      document.body.appendChild(clickEffect);
      setTimeout(() => {
        clickEffect.remove();
      }, 1500 + 100 * aroundImgCount);
    };
    window.addEventListener("click", handleClick);
    // const throttle = (fn, delay) => {
    //   let lastTime = 0;
    //   return function (...args) {
    //     const now = Date.now();
    //     if (now - lastTime >= delay) {
    //       lastTime = now;
    //       fn.apply(this, args);
    //     }
    //   };
    // };
    // const throttledHandleClick = throttle(handleClick, 150);
    // window.addEventListener("touchmove", (e) => {
    //   const touch = e.touches[0];
    //   throttledHandleClick({ clientX: touch.clientX, clientY: touch.clientY });
    // });
    // window.addEventListener("mousemove", (e) => {
    //   throttledHandleClick(e);
    // });
  </script>
</html>
