<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TARDIS 3D Model - Doctor Who</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0a23, #1a1a3a, #2a2a5a);
            font-family: 'Courier New', monospace;
            color: #00ff88;
            overflow: hidden;
        }

        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border: 2px solid #00ff88;
            border-radius: 10px;
            max-width: calc(100% - 40px);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        #info h3 {
            color: #00ff88;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00ff88;
        }

        #info p {
            margin: 5px 0;
            line-height: 1.4;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border: 2px solid #00ff88;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
            max-width: calc(100% - 40px);
        }

        .control-group {
            margin: 15px 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #00ff88;
            font-weight: bold;
        }

        input[type="range"] {
            width: 200px;
            height: 6px;
            background: #333;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: #00ff88;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px #00ff88;
        }

        button {
            background: linear-gradient(45deg, #003366, #004488);
            color: #00ff88;
            border: 1px solid #00ff88;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-family: inherit;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        button:hover {
            background: linear-gradient(45deg, #004488, #0066aa);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
            transform: translateY(-2px);
        }

        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8rem;
            color: #00ff88;
            z-index: 200;
            text-align: center;
            text-shadow: 0 0 15px #00ff88;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 255, 136, 0.3);
            border-left: 4px solid #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff4444;
            color: #ff4444;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
            z-index: 300;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="loading">
            <div>æ­£åœ¨åŠ è½½ TARDIS æ¨¡å‹...</div>
            <div class="loading-spinner"></div>
        </div>
        
        <div id="error">
            <h3>åŠ è½½é”™è¯¯</h3>
            <p>æ— æ³•åŠ è½½ TARDIS æ¨¡å‹æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ã€‚</p>
        </div>
        
        <div id="info" style="display: none;">
            <h3>ğŸš€ TARDIS 3D æ¨¡å‹</h3>
            <p><strong>Time And Relative Dimension In Space</strong></p>
            <p>â€¢ é¼ æ ‡å·¦é”®æ‹–æ‹½: æ—‹è½¬è§†è§’</p>
            <p>â€¢ é¼ æ ‡æ»šè½®: ç¼©æ”¾</p>
            <p>â€¢ é¼ æ ‡å³é”®æ‹–æ‹½: å¹³ç§»</p>
            <p>â€¢ ä½¿ç”¨ä¸‹æ–¹æ§åˆ¶é¢æ¿è°ƒæ•´å‚æ•°</p>
        </div>

        <div id="controls" style="display: none;">
            <div class="control-group">
                <label>è‡ªåŠ¨æ—‹è½¬é€Ÿåº¦:</label>
                <input type="range" id="rotationSpeed" min="0" max="0.03" step="0.001" value="0.005">
                <span id="rotationValue">0.005</span>
            </div>
            <div class="control-group">
                <label>ä¸»å…‰æºå¼ºåº¦:</label>
                <input type="range" id="lightIntensity" min="0" max="3" step="0.1" value="1.5">
                <span id="lightValue">1.5</span>
            </div>
            <div class="control-group">
                <label>ç¯å¢ƒå…‰å¼ºåº¦:</label>
                <input type="range" id="ambientIntensity" min="0" max="1" step="0.05" value="0.3">
                <span id="ambientValue">0.3</span>
            </div>
            <div class="control-group">
                <button id="toggleAnimation">åœæ­¢è‡ªåŠ¨æ—‹è½¬</button>
                <button id="resetView">é‡ç½®è§†è§’</button>
                <button id="toggleWireframe">çº¿æ¡†æ¨¡å¼</button>
            </div>
        </div>
    </div>

    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/MTLLoader.js"></script>

    <script>
        // å…¨å±€å˜é‡
        let scene, camera, renderer, tardisModel, controls;
        let animationId;
        let isAnimating = true;
        let rotationSpeed = 0.005;
        let directionalLight, ambientLight;
        let isWireframe = false;
        
        // åˆå§‹åŒ–åœºæ™¯
        function init() {
            // åˆ›å»ºåœºæ™¯
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x0a0a23, 10, 100);

            // åˆ›å»ºç›¸æœº - è°ƒæ•´åˆå§‹ä½ç½®æ›´è¿œ
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(25, 20, 35); // å¤§å¹…å¢åŠ è·ç¦»

            // åˆ›å»ºæ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ 
                antialias: true, 
                alpha: true,
                powerPreference: "high-performance"
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x0a0a23, 1);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.outputEncoding = THREE.sRGBEncoding;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.2;
            document.getElementById('container').appendChild(renderer.domElement);

            // æ·»åŠ è½¨é“æ§åˆ¶å™¨ - è°ƒæ•´è·ç¦»é™åˆ¶
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.enableZoom = true;
            controls.enablePan = true;
            controls.minDistance = 15; // å¢åŠ æœ€å°è·ç¦»
            controls.maxDistance = 150; // å¢åŠ æœ€å¤§è·ç¦»
            controls.maxPolarAngle = Math.PI;

            // è®¾ç½®ç¯å…‰
            setupLighting();

            // æ·»åŠ æ˜Ÿç©ºèƒŒæ™¯
            createStarField();

            // åˆ›å»ºåœ°é¢
            // createGround();

            // åŠ è½½TARDISæ¨¡å‹
            loadTARDISModel();

            // è®¾ç½®æ§åˆ¶å™¨äº‹ä»¶
            setupControls();

            // å¼€å§‹åŠ¨ç”»å¾ªç¯
            animate();
        }

        // è®¾ç½®ç¯å…‰
        function setupLighting() {
            // ç¯å¢ƒå…‰
            ambientLight = new THREE.AmbientLight(0x404040, 0.3);
            scene.add(ambientLight);

            // ä¸»è¦æ–¹å‘å…‰ (æ¨¡æ‹Ÿå¤ªé˜³å…‰)
            directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
            directionalLight.position.set(10, 15, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 50;
            directionalLight.shadow.camera.left = -20;
            directionalLight.shadow.camera.right = 20;
            directionalLight.shadow.camera.top = 20;
            directionalLight.shadow.camera.bottom = -20;
            directionalLight.shadow.bias = -0.0001;
            scene.add(directionalLight);

            // è“è‰²è¡¥å……å…‰ (æ¨¡æ‹ŸTARDISçš„è“è‰²æ°›å›´)
            const blueLight = new THREE.DirectionalLight(0x4A90E2, 0.3);
            blueLight.position.set(-5, 10, -5);
            scene.add(blueLight);

            // é¡¶éƒ¨ç‚¹å…‰æº (æ¨¡æ‹ŸTARDISç¯å…‰)
            const topLight = new THREE.PointLight(0xffffff, 0.8, 20);
            topLight.position.set(0, 8, 0);
            topLight.castShadow = true;
            scene.add(topLight);
        }

        // åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯
        function createStarField() {
            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({ 
                color: 0xffffff, 
                size: 0.8,
                transparent: true,
                opacity: 0.8
            });

            const starVertices = [];
            for (let i = 0; i < 1500; i++) {
                const x = (Math.random() - 0.5) * 400;
                const y = (Math.random() - 0.5) * 400;
                const z = (Math.random() - 0.5) * 400;
                starVertices.push(x, y, z);
            }

            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }

        // åˆ›å»ºåœ°é¢
        function createGround() {
            const groundGeometry = new THREE.PlaneGeometry(50, 50);
            const groundMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x222222,
                transparent: true,
                opacity: 0.3
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -0.5;
            ground.receiveShadow = true;
            scene.add(ground);
        }

        // åŠ è½½TARDISæ¨¡å‹
        function loadTARDISModel() {
            const mtlLoader = new THREE.MTLLoader();
            
            // é¦–å…ˆåŠ è½½æè´¨æ–‡ä»¶
            mtlLoader.load('./tardisObj/tardis.mtl', function(materials) {
                materials.preload();
                
                // ä¿®æ”¹æè´¨ä»¥ç¬¦åˆTARDISçš„ç»å…¸å¤–è§‚
                if (materials.materials.Blue) {
                    materials.materials.Blue.color.setHex(0x003B6F); // TARDISè“
                    materials.materials.Blue.shininess = 50;
                }
                if (materials.materials.Black) {
                    materials.materials.Black.color.setHex(0x000000);
                }
                if (materials.materials.White) {
                    materials.materials.White.color.setHex(0xffffff);
                    materials.materials.White.emissive.setHex(0x222222);
                }
                
                // åŠ è½½OBJæ–‡ä»¶
                const objLoader = new THREE.OBJLoader();
                objLoader.setMaterials(materials);
                
                objLoader.load('./tardisObj/tardis.obj', function(object) {
                    tardisModel = object;
                    
                    // è°ƒæ•´æ¨¡å‹å¤§å°å’Œä½ç½®
                    tardisModel.scale.set(4, 4, 4); // æ”¾å¤§æ¨¡å‹
                    tardisModel.position.set(0, 0, 0);
                    tardisModel.rotation.y = Math.PI; // æ—‹è½¬180åº¦é¢å‘è§‚å¯Ÿè€…
                    
                    // å¯ç”¨é˜´å½±
                    tardisModel.traverse(function(child) {
                        if (child instanceof THREE.Mesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                            
                            // ç¡®ä¿æè´¨æ­£ç¡®åº”ç”¨
                            if (child.material) {
                                // æ£€æŸ¥æè´¨æ˜¯å¦æœ‰é¢œè‰²å±æ€§
                                if (child.material.color) {
                                    // æ ¹æ®æè´¨åç§°æˆ–é¢œè‰²åˆ¤æ–­æ˜¯å¦ä¸ºè“è‰²æè´¨
                                    if (child.material.name === 'Blue' || child.material.color.r < 0.1) {
                                        child.material.color.setHex(0x003B6F);
                                        child.material.shininess = 50;
                                    }
                                } else if (child.material.name === 'Blue') {
                                    // å¦‚æœæè´¨æ²¡æœ‰é¢œè‰²å±æ€§ä½†åç§°æ˜¯Blueï¼Œåˆ›å»ºæ–°çš„é¢œè‰²
                                    child.material.color = new THREE.Color(0x003B6F);
                                    child.material.shininess = 50;
                                }
                                
                                // å¤„ç†æè´¨æ•°ç»„çš„æƒ…å†µ
                                if (Array.isArray(child.material)) {
                                    child.material.forEach(material => {
                                        if (material.color) {
                                            if (material.name === 'Blue' || material.color.r < 0.1) {
                                                material.color.setHex(0x003B6F);
                                                material.shininess = 50;
                                            }
                                        } else if (material.name === 'Blue') {
                                            material.color = new THREE.Color(0x003B6F);
                                            material.shininess = 50;
                                        }
                                    });
                                }
                            }
                        }
                    });
                    
                    scene.add(tardisModel);
                    
                    // éšè—åŠ è½½æç¤ºï¼Œæ˜¾ç¤ºæ§åˆ¶ç•Œé¢
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('info').style.display = 'block';
                    document.getElementById('controls').style.display = 'block';
                    
                    console.log('TARDIS model loaded successfully!');
                }, 
                // åŠ è½½è¿›åº¦å›è°ƒ
                function(progress) {
                    console.log('Loading progress: ', (progress.loaded / progress.total * 100) + '%');
                },
                // åŠ è½½é”™è¯¯å›è°ƒ
                function(error) {
                    console.error('Error loading OBJ:', error);
                    showError();
                });
            },
            // MTLåŠ è½½è¿›åº¦å›è°ƒ
            function(progress) {
                console.log('MTL Loading progress: ', (progress.loaded / progress.total * 100) + '%');
            },
            // MTLåŠ è½½é”™è¯¯å›è°ƒ
            function(error) {
                console.error('Error loading MTL:', error);
                // å³ä½¿MTLåŠ è½½å¤±è´¥ï¼Œä¹Ÿå°è¯•åŠ è½½OBJ
                loadOBJOnly();
            });
        }

        // ä»…åŠ è½½OBJæ–‡ä»¶ï¼ˆå½“MTLåŠ è½½å¤±è´¥æ—¶ï¼‰
        function loadOBJOnly() {
            const objLoader = new THREE.OBJLoader();
            
            objLoader.load('./tardisObj/tardis.obj', function(object) {
                tardisModel = object;
                
                // åº”ç”¨é»˜è®¤TARDISæè´¨
                tardisModel.traverse(function(child) {
                    if (child instanceof THREE.Mesh) {
                        // ç¡®ä¿åˆ›å»ºæ–°çš„æè´¨è€Œä¸æ˜¯ä¿®æ”¹ç°æœ‰çš„undefinedæè´¨
                        child.material = new THREE.MeshPhongMaterial({
                            color: 0x003B6F,
                            shininess: 50
                        });
                        child.castShadow = true;
                        child.receiveShadow = true;
                    }
                });
                
                tardisModel.scale.set(4, 4, 4);
                tardisModel.position.set(0, 0, 0);
                tardisModel.rotation.y = Math.PI;
                
                scene.add(tardisModel);
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('info').style.display = 'block';
                document.getElementById('controls').style.display = 'block';
                
                console.log('TARDIS model loaded (without MTL)!');
            },
            function(progress) {
                console.log('OBJ Loading progress: ', (progress.loaded / progress.total * 100) + '%');
            },
            function(error) {
                console.error('Error loading OBJ:', error);
                showError();
            });
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
        }

        // è®¾ç½®æ§åˆ¶å™¨
        function setupControls() {
            const rotationSlider = document.getElementById('rotationSpeed');
            const lightSlider = document.getElementById('lightIntensity');
            const ambientSlider = document.getElementById('ambientIntensity');
            const animationButton = document.getElementById('toggleAnimation');
            const resetButton = document.getElementById('resetView');
            const wireframeButton = document.getElementById('toggleWireframe');

            // æ—‹è½¬é€Ÿåº¦æ§åˆ¶
            rotationSlider.addEventListener('input', (e) => {
                rotationSpeed = parseFloat(e.target.value);
                document.getElementById('rotationValue').textContent = rotationSpeed.toFixed(3);
            });

            // ä¸»å…‰æºå¼ºåº¦æ§åˆ¶
            lightSlider.addEventListener('input', (e) => {
                const intensity = parseFloat(e.target.value);
                directionalLight.intensity = intensity;
                document.getElementById('lightValue').textContent = intensity.toFixed(1);
            });

            // ç¯å¢ƒå…‰å¼ºåº¦æ§åˆ¶
            ambientSlider.addEventListener('input', (e) => {
                const intensity = parseFloat(e.target.value);
                ambientLight.intensity = intensity;
                document.getElementById('ambientValue').textContent = intensity.toFixed(2);
            });

            // åŠ¨ç”»å¼€å…³
            animationButton.addEventListener('click', () => {
                isAnimating = !isAnimating;
                animationButton.textContent = isAnimating ? 'åœæ­¢è‡ªåŠ¨æ—‹è½¬' : 'å¼€å§‹è‡ªåŠ¨æ—‹è½¬';
            });

            // é‡ç½®è§†è§’
            resetButton.addEventListener('click', () => {
                camera.position.set(25, 20, 35); // æ›´æ–°é‡ç½®ä½ç½®
                controls.reset();
            });

            // çº¿æ¡†æ¨¡å¼åˆ‡æ¢
            wireframeButton.addEventListener('click', () => {
                isWireframe = !isWireframe;
                if (tardisModel) {
                    tardisModel.traverse(function(child) {
                        if (child instanceof THREE.Mesh && child.material) {
                            // å¤„ç†æè´¨æ•°ç»„çš„æƒ…å†µ
                            if (Array.isArray(child.material)) {
                                child.material.forEach(material => {
                                    if (material) {
                                        material.wireframe = isWireframe;
                                    }
                                });
                            } else {
                                child.material.wireframe = isWireframe;
                            }
                        }
                    });
                }
                wireframeButton.textContent = isWireframe ? 'å®ä½“æ¨¡å¼' : 'çº¿æ¡†æ¨¡å¼';
            });
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            animationId = requestAnimationFrame(animate);

            // è‡ªåŠ¨æ—‹è½¬TARDIS
            if (isAnimating && tardisModel) {
                tardisModel.rotation.y += rotationSpeed;
            }

            // æ›´æ–°æ§åˆ¶å™¨
            controls.update();

            // æ¸²æŸ“åœºæ™¯
            renderer.render(scene, camera);
        }

        // çª—å£å¤§å°è°ƒæ•´
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // äº‹ä»¶ç›‘å¬å™¨
        window.addEventListener('resize', onWindowResize, false);

        // é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', (event) => {
            switch(event.code) {
                case 'Space':
                    event.preventDefault();
                    isAnimating = !isAnimating;
                    document.getElementById('toggleAnimation').textContent = 
                        isAnimating ? 'åœæ­¢è‡ªåŠ¨æ—‹è½¬' : 'å¼€å§‹è‡ªåŠ¨æ—‹è½¬';
                    break;
                case 'KeyR':
                    camera.position.set(25, 20, 35); // æ›´æ–°é‡ç½®ä½ç½®
                    controls.reset();
                    break;
                case 'KeyW':
                    isWireframe = !isWireframe;
                    if (tardisModel) {
                        tardisModel.traverse(function(child) {
                            if (child instanceof THREE.Mesh && child.material) {
                                // å¤„ç†æè´¨æ•°ç»„çš„æƒ…å†µ
                                if (Array.isArray(child.material)) {
                                    child.material.forEach(material => {
                                        if (material) {
                                            material.wireframe = isWireframe;
                                        }
                                    });
                                } else {
                                    child.material.wireframe = isWireframe;
                                }
                            }
                        });
                    }
                    document.getElementById('toggleWireframe').textContent = 
                        isWireframe ? 'å®ä½“æ¨¡å¼' : 'çº¿æ¡†æ¨¡å¼';
                    break;
            }
        });

        // å¯åŠ¨åº”ç”¨
        init();
    </script>
</body>
</html>